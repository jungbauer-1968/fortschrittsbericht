<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fortschritt â€“ Monteur</title>
    <link rel="stylesheet" href="style.css">

    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f1f1f1;
            margin: 0;
            padding: 0;
            text-align: center;
        }

        .box {
            background: white;
            margin: 20px auto;
            padding: 20px;
            width: 90%;
            max-width: 450px;
            border-radius: 10px;
            box-shadow: 0 3px 7px rgba(0,0,0,0.15);
            text-align: left;
        }

        input {
            width: 100%;
            padding: 12px;
            font-size: 17px;
            border-radius: 8px;
            border: 1px solid #ccc;
            margin-top: 5px;
        }

        .btn {
            width: 100%;
            margin-top: 15px;
            padding: 14px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 18px;
        }

        .card {
            background: white;
            padding: 12px 16px;
            margin: 10px auto;
            border-radius: 10px;
            width: 90%;
            max-width: 600px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            text-align: left;
        }

        .title {
            font-size: 22px;
            margin-top: 20px;
            font-weight: bold;
        }

        .badge {
            padding: 6px 10px;
            border-radius: 6px;
            color: white;
            font-weight: bold;
            display: inline-block;
            margin-right: 8px;
            margin-bottom: 5px;
        }

        .red { background: #d9534f; }
        .yellow { background: #f0ad4e; }
        .green { background: #5cb85c; }

        .photos img {
            width: 80px;
            height: 80px;
            border-radius: 10px;
            margin-right: 5px;
            margin-top: 5px;
            object-fit: cover;
        }

    </style>

</head>
<body>

    <h2>ðŸ‘· Fortschritt â€“ Monteur</h2>

    <div id="loginBox" class="box">
        <label>Bitte Nachnamen eingeben:</label>
        <input id="nameInput" type="text" placeholder="z.B. Haindl">
        <button class="btn" onclick="loadReports()">Weiter</button>
    </div>

    <div id="results"></div>

<script>
const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRn9sbmbzT81t1KJQalXVr1agr9E4WUXBOTKrwMWNGimD9CnbCXD2Z2WQzpDMZKl0GVQOKI8mELb3Y0/pub?output=csv";

async function loadReports() {

    const enteredName = document.getElementById("nameInput").value.trim().toLowerCase();
    if (enteredName.length < 2) {
        alert("Bitte gÃ¼ltigen Nachnamen eingeben.");
        return;
    }

    document.getElementById("loginBox").style.display = "none";
    document.getElementById("results").innerHTML = "<p>Lade Daten...</p>";

    const response = await fetch(CSV_URL);
    const csvText = await response.text();

    const rows = csvText.split("\n").map(r => r.split(","));

    const header = rows[0];
    const monteurIndex = header.indexOf("Monteur / Team");

    if (monteurIndex === -1) {
        document.getElementById("results").innerHTML =
            "<p style='color:red;'>Fehler: Spalte 'Monteur / Team' existiert nicht!</p>";
        return;
    }

    const entries = rows.filter((r, i) =>
        i > 0 && r[monteurIndex] && r[monteurIndex].trim().toLowerCase().includes(enteredName)
    );

    if (entries.length === 0) {
        document.getElementById("results").innerHTML =
            "<p>Keine EintrÃ¤ge gefunden. Schreib deinen Namen exakt wie im Bericht.</p>";
        return;
    }

    showReports(entries, header);
}

function showReports(entries, header) {
    let html = `<h3 class="title">ðŸ”§ Deine Baustellen</h3>`;

    entries.forEach(entry => {

        let projekt = entry[1];
        let datum = entry[2];
        let bilderLink = entry[header.indexOf("Fotos")] || "";

        html += `<div class="card">
                    <b>${projekt}</b><br>
                    <small>${datum}</small><br><br>

                    ${renderBadges(entry, header)}

                    ${bilderLink ? renderPhotos(bilderLink) : ""}
                 </div>`;
    });

    document.getElementById("results").innerHTML = html;
}

function renderBadges(row, header) {

    const Bereiche = [
        "Baustelleneinrichtung (%)",
        "Zuleitung & ZÃ¤hlerplÃ¤tze (%)",
        "Rohr- und Tragsysteme (%)",
        "Kabel & Leitungen (%)",
        "Schalt- und SteckgerÃ¤te (%)",
        "PV-Anlage (%)",
        "BeleuchtungskÃ¶rper (%)",
        "AuÃŸenbeleuchtung (%)",
        "Antennenanlage (%)",
        "Brandrauchmelder (%)"
    ];

    let out = "";

    Bereiche.forEach(name => {
        const index = header.indexOf(name);
        if (index === -1) return;
        let value = parseInt(row[index]);

        let color = "yellow";
        if (value <= 33) color = "red";
        else if (value >= 67) color = "green";

        out += `<span class="badge ${color}">${name.replace("(%)","")}: ${value}%</span>`;
    });

    return out;
}

function renderPhotos(link) {
    return `
        <div class="photos">
            <p><b>ðŸ“¸ Fotos:</b></p>
            <a href="${link}" target="_blank">Fotos Ã¶ffnen</a>
        </div>
    `;
}

</script>

</body>
</html>
